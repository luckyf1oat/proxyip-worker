# 检测方式对比

## 方案一: Python本地检测 (检测proxyip.py)

### 适用场景
- 需要详细的IP信息 (ASN、风险评分、公司信息等)
- 需要按国家分类保存结果
- 需要生成多种排序的CSV文件
- 本地有大量IP需要批量检测

### 优势
- ✅ 400并发，检测速度极快
- ✅ 完整的IP信息查询 (ipapi.is)
- ✅ 风险评分和纯净度分析
- ✅ 存活时间计算
- ✅ 按国家分类输出
- ✅ 支持历史数据增量更新

### 劣势
- ❌ 需要本地SOCKS5代理
- ❌ 需要手动运行
- ❌ 依赖Python环境和库
- ❌ 结果存储在本地文件

### 使用方法
```bash
cd "C:\Users\Administrator\Desktop\ip - 副本"
python 检测proxyip.py
```

---

## 方案二: GitHub Actions云端检测 (check-script.js)

### 适用场景
- 已有Cloudflare Workers管理系统
- 需要自动化定时检测
- 只需要存活检测和延迟测试
- 不需要详细IP信息

### 优势
- ✅ 完全自动化，无需人工干预
- ✅ 不需要本地代理
- ✅ 免费运行 (GitHub Actions)
- ✅ 结果直接写入KV，Web界面可查看
- ✅ 支持Telegram通知
- ✅ 自动解析到Cloudflare DNS

### 劣势
- ❌ 并发度较低 (30并发)
- ❌ 不查询IP详细信息
- ❌ 不生成CSV文件
- ❌ 依赖Cloudflare KV存储

### 使用方法
1. 配置GitHub Secrets
2. 推送代码到GitHub
3. 自动每4小时运行一次
4. 或手动触发运行

---

## 推荐使用方式

### 场景1: 初次大批量检测
**使用Python版本**
1. 准备好所有IP的CSV文件
2. 运行Python脚本进行详细检测
3. 获得完整的风险评分和分类结果
4. 选择优质IP导入到Cloudflare Workers系统

### 场景2: 日常维护和监控
**使用GitHub Actions版本**
1. 将筛选后的IP导入Workers管理系统
2. GitHub Actions每4小时自动检测存活状态
3. 自动更新DNS解析
4. 失效IP自动标记

### 场景3: 混合使用
1. **每周**: Python本地检测，获取新IP并评分
2. **每天**: GitHub Actions自动维护现有IP
3. **实时**: Cloudflare Workers提供Web管理界面

---

## 性能对比

| 项目 | Python版本 | GitHub Actions版本 |
|------|-----------|-------------------|
| 并发数 | 400 | 30 |
| 检测1000个IP | ~3分钟 | ~10分钟 |
| 超时设置 | 10秒 | 10秒 |
| 重试次数 | 1次 | 1次 |
| IP信息查询 | ✅ 是 | ❌ 否 |
| 自动化 | ❌ 手动 | ✅ 自动 |
| 依赖代理 | ✅ 需要 | ❌ 不需要 |

---

## 数据流转示例

```
┌─────────────────┐
│  FOFA/其他来源   │
│   (原始IP列表)   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Python本地检测  │  ← 详细分析、风险评分
│ (检测proxyip.py) │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  筛选优质IP     │  ← 选择低风险、高存活的IP
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Workers管理系统  │  ← 导入CSV，配置分组
│   (Web界面)     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ GitHub Actions  │  ← 每4小时自动检测
│   (自动维护)    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Cloudflare DNS  │  ← 自动解析最优IP
└─────────────────┘
```

---

## 常见问题

### Q: 为什么GitHub Actions不查询IP详细信息?
A: ipapi.is有严格的速率限制，大量查询会被限流。Python版本通过本地代理可以规避，但GitHub Actions无法使用代理。

### Q: 可以提高GitHub Actions的并发数吗?
A: 可以修改 `BATCH = 30` 为更大值，但要注意GitHub Actions的网络限制。

### Q: 两个版本可以同时使用吗?
A: 可以。Python版本用于初次检测和定期深度分析，GitHub Actions用于日常自动维护。

### Q: 如何将Python检测结果导入Workers?
A: 在Workers Web界面的"IP管理"页面，选择分组后上传Python生成的CSV文件。
