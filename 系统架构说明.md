# Workers和Actions的关系说明

## 🏗️ 系统架构

```
你的完整系统 = Workers网站 + GitHub Actions自动检测

┌─────────────────────────────────────────────────────────┐
│                                                         │
│  你现在访问的Workers网站 (已经有了)                      │
│  https://你的域名.workers.dev                           │
│                                                         │
│  功能:                                                  │
│  ✅ 网页界面管理IP                                      │
│  ✅ 手动上传CSV                                         │
│  ✅ 查看IP状态                                          │
│  ✅ 配置分组                                            │
│  ✅ 手动触发检测 (点击按钮)                             │
│                                                         │
└────────────────┬────────────────────────────────────────┘
                 │
                 │ 读写数据
                 ▼
┌─────────────────────────────────────────────────────────┐
│                                                         │
│  Cloudflare KV 数据库 (已经有了)                        │
│                                                         │
│  存储内容:                                              │
│  - config (配置)                                        │
│  - groups (分组列表)                                    │
│  - ips:kr (韩国IP列表)                                  │
│  - ips:jp (日本IP列表)                                  │
│  - last_result (最后检测结果)                           │
│                                                         │
└────────────────▲────────────────────────────────────────┘
                 │
                 │ 读写数据
                 │
┌────────────────┴────────────────────────────────────────┐
│                                                         │
│  GitHub Actions 自动检测 (要新加的)                     │
│                                                         │
│  功能:                                                  │
│  ✅ 每4小时自动运行                                     │
│  ✅ 从KV读取IP列表                                      │
│  ✅ 检测每个IP是否存活                                  │
│  ✅ 把结果写回KV                                        │
│  ✅ 自动解析DNS                                         │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## 🔄 工作流程

### 现在 (只有Workers)
```
1. 你手动上传IP到Workers网站
2. 你点击"检测"按钮
3. Workers检测IP (但有时间限制，可能超时)
4. 显示结果
```

### 部署Actions后
```
1. 你手动上传IP到Workers网站
2. GitHub Actions每4小时自动检测
3. 检测结果自动更新到KV
4. 你打开Workers网站就能看到最新状态
5. 你也可以随时手动触发检测
```

## 📊 数据流转示例

### 场景: 你上传了100个韩国IP

```
第1步: 在Workers网站上传CSV
┌──────────────┐
│ 你的电脑     │
│ 上传CSV文件  │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ Workers网站  │
│ 保存到KV     │
└──────┬───────┘
       │
       ▼
┌──────────────────┐
│ KV数据库         │
│ ips:kr = [100个] │
└──────────────────┘

第2步: GitHub Actions自动检测 (每4小时)
┌──────────────────┐
│ GitHub Actions   │
│ 从KV读取100个IP  │
└──────┬───────────┘
       │
       ▼
┌──────────────────┐
│ 检测API          │
│ 测试每个IP       │
└──────┬───────────┘
       │
       ▼
┌──────────────────┐
│ 检测结果         │
│ 有效: 45个       │
│ 失效: 55个       │
└──────┬───────────┘
       │
       ▼
┌──────────────────┐
│ KV数据库         │
│ 更新IP状态       │
└──────────────────┘

第3步: 你查看结果
┌──────────────┐
│ 你的电脑     │
│ 打开网站     │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ Workers网站  │
│ 从KV读取数据 │
└──────┬───────┘
       │
       ▼
┌──────────────────┐
│ 显示结果         │
│ ✅ 45个有效      │
│ ❌ 55个失效      │
└──────────────────┘
```

## 🤔 为什么需要GitHub Actions？

### Workers的限制
- ⏱️ 单次运行最多30秒 (CPU时间)
- ⏱️ 总运行时间最多几分钟
- 🔄 检测大量IP会超时

### GitHub Actions的优势
- ⏱️ 单次运行最多6小时
- 🔄 可以慢慢检测，不怕超时
- 🤖 自动运行，不用手动点击
- 💰 免费 (每月2000分钟)

## 📝 总结

**Workers** = 你的管理后台 (网页界面)
- 用来: 上传IP、查看结果、配置设置

**GitHub Actions** = 你的自动检测机器人
- 用来: 定时检测IP、更新状态

**KV** = 共享数据库
- 两者都访问同一个数据库

**关系**:
- Workers负责"展示和管理"
- Actions负责"自动检测"
- KV负责"存储数据"

## ❓ 你可能的疑问

**Q: 部署Actions会影响现有的Workers吗？**
A: 不会！它们是独立的，只是共享同一个KV数据库

**Q: 我必须部署Actions吗？**
A: 不是必须的，但强烈推荐：
- 不部署: 需要手动点击检测，可能超时
- 部署后: 自动检测，永不超时

**Q: 部署后Workers还能用吗？**
A: 完全可以！Workers网站照常使用，只是多了自动检测功能

**Q: 如果我不想要Actions了怎么办？**
A: 在GitHub仓库删除 `.github/workflows` 文件夹即可

**Q: Actions会消耗我的Cloudflare配额吗？**
A: 不会！Actions运行在GitHub的服务器上，只是通过API访问你的KV
