# 系统功能说明

## ✅ 已完成的修改

### 1. Workers自动检测已禁用
- ❌ Workers的定时检测功能已关闭
- ✅ 改用GitHub Actions每4小时自动检测
- ✅ 保留Web界面的手动检测按钮

### 2. 检测方式对比

| 功能 | Workers检测 | GitHub Actions检测 |
|------|------------|-------------------|
| 自动运行 | ❌ 已禁用 | ✅ 每4小时 |
| 手动触发 | ✅ Web界面按钮 | ✅ GitHub Actions页面 |
| 超时限制 | 30秒 | 无限制 |
| 并发数 | 30 | 30 |
| 适用场景 | 快速测试 | 日常维护 |

---

## 🎯 使用方式

### 方式1: GitHub Actions自动检测 (推荐)

**配置一次，自动运行**

1. 配置GitHub Secrets (只需一次)
2. 每4小时自动检测所有IP
3. 自动更新KV数据库
4. 自动解析DNS
5. 发送Telegram通知

**查看结果**:
- 访问: https://fxpip.5671234.xyz
- 或访问: https://github.com/luckyf1oat/proxyip-worker/actions

---

### 方式2: Workers手动检测

**快速测试单个分组**

1. 访问: https://fxpip.5671234.xyz
2. 登录后进入"IP管理"
3. 选择分组
4. 点击"🔍 检测本组"按钮

**适用场景**:
- 新上传IP后快速验证
- 测试单个分组
- 紧急情况需要立即检测

**限制**:
- 单次最多30秒
- 大量IP可能超时

---

### 方式3: 本地测试

**开发调试用**

双击运行: `手动测试.bat`

输入凭证后，在本地运行检测脚本，查看详细日志。

---

## 📊 推荐工作流程

### 日常使用

```
1. 在Workers Web界面上传新IP
   ↓
2. 点击"检测本组"快速验证
   ↓
3. GitHub Actions每4小时自动维护
   ↓
4. 查看Web界面的最新状态
```

### 大批量IP

```
1. 使用Python脚本本地检测 (详细信息)
   ↓
2. 筛选优质IP上传到Workers
   ↓
3. GitHub Actions自动维护
```

---

## 🔧 配置说明

### GitHub Secrets配置

访问: https://github.com/luckyf1oat/proxyip-worker/settings/secrets/actions

添加3个Secrets:

| Name | 说明 | 获取方式 |
|------|------|---------|
| `CF_ACCOUNT_ID` | Cloudflare账户ID | Dashboard右侧 |
| `CF_KV_NAMESPACE_ID` | KV命名空间ID | Workers & Pages > KV |
| `CF_API_TOKEN` | API令牌 | Profile > API Tokens |

### API Token权限

创建Token时需要以下权限:
- Account > Workers KV Storage > **Edit**
- Zone > DNS > **Edit**

---

## 🧪 测试步骤

### 1. 本地测试 (可选)

```bash
cd c:\Users\Administrator\Desktop\proxyip-worker
手动测试.bat
```

### 2. GitHub Actions测试

1. 访问: https://github.com/luckyf1oat/proxyip-worker/actions
2. 点击左侧 "ProxyIP检测"
3. 点击右侧 "Run workflow"
4. 点击绿色 "Run workflow" 确认
5. 查看运行日志

### 3. 验证结果

访问: https://fxpip.5671234.xyz

查看"概览"页面的检测结果

---

## ❓ 常见问题

### Q: Workers还能手动检测吗?
A: 可以！在Web界面点击"检测本组"按钮仍然可用。

### Q: 为什么禁用Workers自动检测?
A: Workers有30秒CPU时间限制，大量IP会超时。GitHub Actions无限制，更稳定。

### Q: 多久检测一次?
A: GitHub Actions每4小时自动检测。可以在 `.github/workflows/check-proxy.yml` 修改频率。

### Q: 可以手动触发检测吗?
A: 可以！
- Workers: Web界面点击按钮
- GitHub Actions: Actions页面点击 "Run workflow"

### Q: 检测结果在哪里看?
A: 访问 https://fxpip.5671234.xyz 查看最新结果

---

## 📁 文件说明

| 文件 | 用途 |
|------|------|
| `worker.js` | Workers代码 (已禁用自动检测) |
| `check-script.js` | GitHub Actions检测脚本 |
| `.github/workflows/check-proxy.yml` | Actions工作流配置 |
| `手动测试.bat` | 本地测试脚本 |
| `推送到GitHub.bat` | 推送代码到GitHub |

---

## 🎉 总结

现在你的系统:
- ✅ Workers负责Web管理界面
- ✅ GitHub Actions负责自动检测
- ✅ 两者共享同一个KV数据库
- ✅ 可以随时手动触发检测
- ✅ 每4小时自动维护IP状态

完美的分工！
