# 超简单部署指南 - 5分钟搞定

## 🎯 目标

让GitHub Actions每4小时自动检测你Workers系统里的IP

## 📦 你现在有什么

1. ✅ Cloudflare Workers (网站管理界面) - 应该已经部署了
2. ✅ KV数据库 - 存储IP数据
3. ❌ GitHub Actions - **这是要新加的自动检测功能**

## 🚀 部署步骤 (3步)

### 第1步: 获取3个密钥 (5分钟)

打开3个网页，复制3个值：

#### 密钥1: Account ID
1. 打开 https://dash.cloudflare.com
2. 点击任意域名
3. 右侧找到 **Account ID**，点击复制
4. 粘贴到记事本，标记为 `Account ID`

#### 密钥2: KV Namespace ID
1. 打开 https://dash.cloudflare.com
2. 左侧菜单 Workers & Pages > KV
3. 找到你的KV命名空间，点击进入
4. 右侧找到 **Namespace ID**，复制
5. 粘贴到记事本，标记为 `KV ID`

#### 密钥3: API Token
1. 打开 https://dash.cloudflare.com/profile/api-tokens
2. 点击 **Create Token**
3. 点击 **Create Custom Token**
4. 填写:
   - Token名称: `GitHub Actions`
   - 权限1: Account > Workers KV Storage > Edit
   - 权限2: Zone > DNS > Edit
5. 点击 **Continue to summary** > **Create Token**
6. **立即复制Token** (只显示一次!)
7. 粘贴到记事本，标记为 `API Token`

现在你的记事本应该有3个值：
```
Account ID: abc123...
KV ID: def456...
API Token: xyz789...
```

---

### 第2步: 创建GitHub仓库并配置密钥 (3分钟)

#### 2.1 创建仓库
1. 打开 https://github.com/new
2. 仓库名: `proxyip-worker`
3. 选择 **Public** 或 **Private**
4. 点击 **Create repository**

#### 2.2 配置密钥
1. 在刚创建的仓库页面
2. 点击 **Settings** (设置)
3. 左侧菜单: **Secrets and variables** > **Actions**
4. 点击 **New repository secret**

添加3个密钥 (一个一个添加):

**密钥1:**
- Name: `CF_ACCOUNT_ID`
- Secret: 粘贴你的 Account ID
- 点击 **Add secret**

**密钥2:**
- Name: `CF_KV_NAMESPACE_ID`
- Secret: 粘贴你的 KV ID
- 点击 **Add secret**

**密钥3:**
- Name: `CF_API_TOKEN`
- Secret: 粘贴你的 API Token
- 点击 **Add secret**

配置完成后应该看到3个绿色的密钥。

---

### 第3步: 上传代码 (2分钟)

#### 方法A: 使用命令行 (推荐)

打开命令行，执行：

```bash
cd c:\Users\Administrator\Desktop\proxyip-worker

# 初始化git
git init

# 添加文件
git add .

# 提交
git commit -m "添加自动检测"

# 关联仓库 (替换成你的仓库地址)
git remote add origin https://github.com/你的用户名/proxyip-worker.git

# 推送
git branch -M main
git push -u origin main
```

#### 方法B: 手动上传

1. 在GitHub仓库页面点击 **uploading an existing file**
2. 把这些文件拖进去:
   - `check-script.js`
   - `.github/workflows/check-proxy.yml`
   - `worker.js`
   - `wrangler.toml`
3. 点击 **Commit changes**

---

## ✅ 验证是否成功

### 1. 查看Actions
1. 进入GitHub仓库
2. 点击 **Actions** 标签
3. 应该能看到 "ProxyIP检测" 工作流

### 2. 手动测试
1. 点击左侧 **ProxyIP检测**
2. 点击右侧 **Run workflow** 按钮
3. 点击绿色 **Run workflow** 确认
4. 等待几秒刷新，会出现一个运行记录
5. 点击进去查看日志

### 3. 查看日志
展开 "运行检测脚本"，应该看到：
```
[*] 第一阶段(测速)开始: XX 个IP
    [+] 有效IP: 1.2.3.4:443 | 延迟: 123ms | 机房: HKG
...
[+] 检测完成: 总计 XX, 有效 XX, 失效 XX
```

### 4. 查看结果
回到你的Workers管理网站，刷新页面，应该能看到更新的IP状态。

---

## 🎉 完成！

现在系统会：
- ✅ 每4小时自动检测所有IP
- ✅ 更新Workers网站的数据
- ✅ 自动解析最优IP到DNS
- ✅ 发送Telegram通知 (如果配置了)

---

## ❓ 常见问题

**Q: 我的Workers网站地址是什么？**
A: 应该是 `https://你的worker名称.你的账户.workers.dev`

**Q: 如何查看检测结果？**
A: 访问你的Workers网站，在"概览"页面查看

**Q: Actions运行失败怎么办？**
A: 点击失败的运行记录，查看错误信息：
- `401 Unauthorized` = API Token权限不够
- `404 Not Found` = Account ID或KV ID错误

**Q: 如何修改检测频率？**
A: 编辑 `.github/workflows/check-proxy.yml`，修改 `cron` 那行

**Q: 可以手动触发检测吗？**
A: 可以！在Actions页面点击 "Run workflow"

---

## 📞 需要帮助？

如果遇到问题，告诉我：
1. 在哪一步卡住了
2. 看到什么错误信息
3. 截图发给我
